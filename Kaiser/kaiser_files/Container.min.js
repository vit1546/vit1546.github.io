/* Copyright Â© 2016 Epic Systems Corporation. */

/*! Copyright (c) Epic Systems Corporation 2014-2015 */
$$WP.Utilities.declareComponent("Containers.Container");$$WP.Containers.Container.prototype={IsClosable:true,Title:{Text:"",Buttons:[],Image:null,Class:"titlebar",Identifier:"titlebar"},Content:{Text:"",Template:null,Data:null},$Parent:$(document.body),_click:function Containers$Container$_click(c,b){var a=this;if(a.IsClosable&&b===a._closeIndex)a.dispose();else a.focusOnContent()},_focus:function Containers$Container$_focus(){if(this.iconKeepFocusOnce===true)return;this.focusOnContent()},_Components:[],_Init:function $$WP$Containers$Container$_Init(b){var a=this;a.Components$Component(b);a.$Parent=b.$Parent&&b.$Parent.length>0?b.$Parent:a.$Parent&&a.$Parent.length>0?a.$Parent:$(document.body);a.$Parent.append(a.$container);delete b.$Parent;a._Components=[];a.IsClosable=typeof b.IsClosable==="boolean"?b.IsClosable:a.IsClosable;delete b.IsClosable;a.Title=$$WP.Utilities.mergeObjects($$WP.Containers.Container.prototype.Title,a.Title,true);a.Title=$$WP.Utilities.mergeObjects(a.Title,b.Title,true);if(a.hasTitle()){a.Title._clickContext=a.Title._clickContext||a;a.Title.Identifier=a.Title.Identifier||"titlebar";if(a.IsClosable){a.Title.Buttons=a.Title.Buttons||[];a._closeIndex=a.Title.Identifier+a.Title.Buttons.length;a.Title.Buttons.push({Class:"cancelworkflow",Image:{Src:makeStaticLink("Images/close_popup.png"),Class:"close",Alt:$$WP.Components.Component.decodeMnemonics($$WP.Strings.get("ClosePopupAlt"+(a.Title.Text?"WithTitle":""),"Global"),{PopupTitle:a.Title.Text})}})}a.$container.addClass("textlessTitle")}else{a.Title=a.Title||{};a.Title.Class="titlebar nobuttons";a.Title.Image={Src:a.Title.Src||makeLink("favicon.ico"),Class:a.Title.Class||"titlebaricon",Alt:$$WP.Strings.get("JumpToContent","Global")};a.$container.addClass("notitle")}a.titleComponent=new $$WP.Components.ButtonBar({Data:a.Title});a.titleComponent.Container=a;a.$container.append(a.titleComponent.$container);a.titleComponent.show();a.titleComponent.$container.find(".button").removeClass("button");a.$content=$(document.createElement("div")).addClass("content");a.$container.append(a.$content);if(b.Components){a.addComponent(b.Components);delete a.Components}a.Content=$$WP.Utilities.mergeObjects(a.Content,b.Content,true);delete b.Content},hasComponents:function Containers$Container$hasComponents(){return!this._Components?false:this._Components.length>0},show:function(c){var a=this;if(a._visible===true)return;a.Components$Component$show();if(a.hasTitle()){$$WP.Behaviors.EventHandlers.on("click",a);if(a.titleComponent.$container.find(".titlebaricon").length>0)$$WP.Behaviors.EventHandlers.on("focus",a)}if(c)for(var b=0;b<a._Components.length;b++)a._Components[b].show();if(!a._readyToSet&&a.refresh)try{a.refresh()}catch(d){}},hide:function Containers$Container$hide(c){var a=this;if(a._visible===false)return;a.Components$Component$hide();if(a.hasTitle()){$$WP.Behaviors.EventHandlers.off("click",a);a.titleComponent.$container.find(".titlebaricon").length>0&&$$WP.Behaviors.EventHandlers.off("focus",a)}if(c)for(var b=0;b<a._Components.length;b++)a._Components[b].hide()},_readyToSet:false,refresh:function Containers$Container$refresh(){var a=this;a._readyToSet=true;var c,b;if(a.hasComponents()){for(c=0;c<a._Components.length;c++)a._Components[c]&&a._Components[c].refresh&&a._Components[c].refresh();return}if(!a.Content)return;if(typeof a.Content.Template==="function"){b=a.Content.Template(a.Content.Data||{});b=$$WP.Components.Component.decodeMnemonics(b,a.mnemonics);a.$content.html(b)}else{b=$$WP.Components.Component.decodeMnemonics(a.Content.Text,a.mnemonics);a.$content.html(b)}},hasTitle:function Containers$Container$hasTitle(){var a=this;return a.IsClosable||a.Title&&(a.Title.Text||a.Title.Buttons&&a.Title.Buttons.length>0)},focus:function Containers$Container$focus(){var c=WP.DOM.Search.getFocused(),a=c,b=this.$container.get(0),d=this;while(a!==document.body&&a&&a!==b)a=a.parentNode;if(a===b)return;this._previousFocus=c;window.setTimeout(function ContainerFocus(){try{var a=WP.DOM.Search.getNextFocusable(d.$container.get(0));a.focus()}catch(b){}},1)},focusOnContent:function Containers$Container$focusOnContent(){var a=WP.DOM.Search.getFocused();if(this.$container.contains(a))return;try{WP.DOM.Search.getNextFocusable(this.$content.get(0)).focus()}catch(b){}},addComponent:function Containers$Container$addComponent(a){var b=this;if(!a)return;var c;if($.isArray(a)){for(c=0;c<a.length;c++)b.addComponent(a[c]);return}if(a.Container){a.Container.removeComponent(a,true);a.hide()}if(typeof a==="string")b.Content.Text=a;else if(!isNaN(a._componentNumber)){b._Components.push(a);b._visible===true&&a.refresh&&a.refresh();b.$content.append(a.$container);a.Container=b}else if(typeof a.Template==="function"||typeof a.Data==="object"){b.Content.Template=a.Template||b.Content.Template;b.Content.Data=a.Data||b.Content.Data}b._visible===true&&a.show&&a.show()},removeComponent:function Containers$Container$removeComponent(a,b){this.$container.remove(a.$container);delete this._Components[a._componentNumber];delete a.Container;delete a._containerNumber;b!==true&&a.dispose()},clearComponents:function Containers$Container$clearComponents(c){for(var a,b=0;b<this._Components.length;b++){a=this._Components[b];c!==true&&a.dispose();a.$container.remove()}this._Components=[]},dispose:function $$WP$Containers$Container$dispose(){this.clearComponents();this.Components$Component$dispose(true);this._readyToSet=false}};$$WP.Containers.Container.extend("Components.Component")