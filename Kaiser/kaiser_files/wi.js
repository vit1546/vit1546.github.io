/*
	Copyright (c) 2004-2009, The Dojo Foundation All Rights Reserved.
	Available via Academic Free License >= 2.1 OR the modified BSD license.
	see: http://dojotoolkit.org/license for details
*/

/*
	This is a compiled version of Dojo, built for deployment and not for
	development. To get an editable version, please visit:

		http://dojotoolkit.org

	for documentation and information on getting the source.
*/

dojo.provide("kaiser.wi");if(!dojo._hasResource["kaiser.wi.Webtrends"]){dojo._hasResource["kaiser.wi.Webtrends"]=true;dojo.provide("kaiser.wi.Webtrends");if(typeof kaiserConfig=="undefined"){kaiserConfig={wi:{isDebug:true}};}if(typeof kaiserConfig.wi=="undefined"){kaiserConfig.wi={isDebug:true};}if(kaiserConfig.wi.isWtInside){dojo["require"]("kpjs.webtrends");_tag=new WebTrends();if(kaiserConfig.wi.isDebug){console.log("kaiser.wi.Webtrends.js: webtrends.js isWtInside... loaded webtrends.js like dojo resource with build 111 keep requires using dojo[\"require\"](\"kpjs.webtrends\") and created _tag global");}}dojo.declare("kaiser.wi.Webtrends",null,{DEFAULT_DOMAIN:"wpp-sigma.crdc.kp.org",DEFAULT_DCSID:"dcsv93pop10000kbylzfs8804_3j5y",DEFAULT_FILTER:/empty/,DEFAULT_EVENT:66,hasCollected:false,constructor:function(){if(kaiserConfig.wi.isDebug){console.log("kaiser.wi.Webtrends.constructor(): Instantiating; _tag=",_tag);}this.tag=_tag;this.tag.isEtRegNative=false;this.validate();this.dcsuri=null;_this=this;this.tag.dcsAll=function(_1){if("true"==kaiserConfig.wi.isActive){_1=_1||(window.event||"");if(_1&&((typeof (_1.which)!="number")||(_1.which==1))){var e=this.dcsEvt(_1,"A");if(e.href){var hn=e.hostname?(e.hostname.split(":")[0]):"";if(!this.dcsTypeMatch(e.pathname,this.downloadtypes)){var _2=false;var _3="theme_action";var _4="";var dl=64;var _5=_this._trackedLinkLevel(e);switch(_5){case 1:_2=true;break;case 2:_2=true;break;case 3:_2=true;break;case 4:_2=kaiserConfig.wi.linkTracking;dl=63;_3="page_action";break;}if(_2){var _6="";var _7=document.all?e.innerText:e.text;if(document.title){if(window.RegExp){var _8=new RegExp("^"+window.location.protocol+"//"+window.location.hostname+"\\s-\\s");_6=document.title.replace(_8,"");}else{_6=document.title;}}else{var _9=this.dcsEvt(_1,"IMG");if(_9.alt){_7=_this._sanitize(_9.alt);}else{if(e.innerHTML){_7=_this._sanitize(e.innerHTML);}else{if(_7){_7=_this._sanitize(_7);}}}}if(_6==""){_6=_7;}this.WT.si_n=this.WT.si_x="";this.dcsMultiTrack("WT.ti",_6,"WT.dl",dl,"WT.nv",this.dcsNavigation(_1),"DCSext.kp_event_type",_3,"DCSext.kp_userAction",_this._areaId(_5)+": "+_7,"DCSext.kp_navLayer",_5);this.WT.ti=this.WT.dl=this.WT.nv=this.DCSext.kp_event_type=this.DCSext.kp_userAction=this.DCSext.kp_navLayer="";}}}}}};},_multiTrack:function(_a,_b){this.updateROP();if(romMetaNode=dojo.query("meta[name='DCSExt.region_of_membership']")[0]){var _c=romMetaNode.content;var _d=-1;for(x=0;x<_b.length;x++){if(_b[x]==="DCSext.region_of_membership"){_d=x;if(kaiserConfig.wi.isDebug){console.log("Found parameter  {DCSext.region_of_membership} at ",_d);}if(kaiserConfig.wi.isDebug){console.log("Found parameter  {DCSext.region_of_membership value} is ",_b[_d+1]);}}}var _e=_b[_d+1];if(kaiserConfig.wi.isDebug){console.log("WT: ROM[META] = ",_c," - ROM[PARA] = ",_e);}if(_e==="-"){_b[_d+1]=_c;if(kaiserConfig.wi.isDebug){console.log("WT:DCSExt.region_of_membership = ROM[META] = ");}}else{if(kaiserConfig.wi.isDebug){console.log("WT:DCSext.region_of_membership = ROM[PARA] = ");}}}else{if(kaiserConfig.wi.isDebug){console.log("WT:DCSExt.region_of_membership = ROM[PARA] => ",_b[_d+1]);}}if("kp_page_view"!==_a){this.tag.WT.dl=this.DEFAULT_EVENT;}var _f=document.title;var _10=document.title;if(document.title){if(window.RegExp){var _11=new RegExp("^"+window.location.protocol+"//"+window.location.hostname+"\\s-\\s");_10=document.title.replace(_11,"");}else{_10=document.title;}}_10=_10.replace(/-\shealth\sencyclopedia/i,"").replace(/-\skaiser permanente/i,"");this.tag.WT.ti=_10;document.title=_10;if(kaiserConfig.wi.isDebug){console.log("WT: title in _multitrack : old=",_f," ; new(sent)=",_10);}if("cm_download_link"===_a){this.tag.DCSext.kp_event_type=_a;this.tag.WT.es=undefined;this.tag.dcsVar();this.tag.dcsMeta();this.hasCollected=true;this.tag.dcsMultiTrack.apply(this.tag,_b);this.tag.DCSext.kp_CAT=this.tag.DCSext.kp_DNM=this.tag.DCSext.kp_SYS=this.tag.DCSext.kp_DID=this.tag.DCSext.kp_ID=this.tag.DCSext.kp_BYT=this.tag.DCSext.kp_T2=this.tag.DCSext.kp_T1=this.tag.DCSext.kp_DAT=this.tag.DCSext.kp_userAction="";this._clean();if(kaiserConfig.wi.isDebug){console.log("WT: kaiser.wi.handler.BaseHandler._send(): Sent ",_a," using ","_mutliTrack*");}}else{if(this.hasCollected===false){console.warn("kaiser.wi.handler.BaseHandler._send(): Out of sequence event: ",_a," - changed to: collect");this._collect(_a);}else{this.tag.DCSext.kp_event_type=_a;this.tag.dcsMultiTrack.apply(this.tag,_b);this._clean();if(kaiserConfig.wi.isDebug){console.log("WT: kaiser.wi.handler.BaseHandler._send(): Sent ",_a," using ","mutliTrack");}}}document.title=_f;},_collect:function(_12){this.tag.DCSext.kp_event_type=_12;this.updateROP();if(typeof (wi_sub_pages)!="undefined"&&wi_sub_pages&&wi_sub_pages.length>0){this.tag.WT.cg_n=wi_sub_pages;var _13=document.getElementsByName("WT.wsp_bc").item(0);_13.setAttribute("CONTENT",_13.getAttribute("CONTENT")+"|"+wi_sub_pages);}var _14=document.title;var _15=document.title;_15=_15.replace(/-\shealth\sencyclopedia/i,"").replace(/-\skaiser permanente/i,"");this.tag.WT.ti=_15;document.title=_15;if(kaiserConfig.wi.isDebug){console.log("WT: Pageview title in _collect :",document.title);}if(kaiserConfig.wi.isDebug){console.log("WT: title in _multitrack : old=",_14," ; new(sent)=",_15);}this.tag.WT.es=undefined;this.tag.dcsCollect();this.hasCollected=true;this._clean();document.title=_14;if(kaiserConfig.wi.isDebug){console.log("WT: kaiser.wi.handler.BaseHandler._send(): Sent ",_12," using _collect");}},updateROP:function(){dojo["require"]("dojo.cookie");var rop=dojo.cookie("ImpSessionRoP");if(kaiserConfig.wi.isDebug){console.log("WT: kaiser.wi.Webtrends : ROP read from cookie is -> ",rop);}rop=rop?rop:"-";if(metaNode=dojo.query("meta[name='DCSExt.region_of_preference']")[0]){metaNode.content=rop;if(kaiserConfig.wi.isDebug){console.log("WT: \"DCSExt.region_of_preference\" updated to : "+rop);}}},_clean:function(){/ * this.tag.DCSext = {}; need all events to have the DCSext values passed along */;this.tag.DCSext.kp_condition_description="";this.tag.WT.si_n=undefined;this.tag.WT.si_x=undefined;this.tag.WT.si_cs=undefined;this.tag.WT.dl=undefined;this.tag.DCSext.kp_proxy="";},validate:function(){if(this.isEmpty(kaiserConfig.wi.dcsid)){kaiserConfig.wi.dcsid=this.DEFAULT_DCSID;}if(this.isEmpty(kaiserConfig.wi.domain)){kaiserConfig.wi.domain=this.DEFAULT_DOMAIN;}if(this.isEmpty(kaiserConfig.wi.navStartLevel)){kaiserConfig.wi.navStartLevel=1;}if(this.isEmpty(kaiserConfig.wi.isActive)){kaiserConfig.wi.isActive=false;}if(this.isEmpty(kaiserConfig.wi.hccFilter)){kaiserConfig.wi.hccFilter=this.DEFAULT_FILTER;}else{try{kaiserConfig.wi.hccFilter=new RegExp(kaiserConfig.wi.hccFilter);}catch(err){console.error("kaiser.wi.Webtrends.validate(): Invalid regexp: ",kaiserConfig.wi.hccFilter);kaiserConfig.wi.hccFilter=/error/;}}this.tag.domain=kaiserConfig.wi.domain;this.tag.dcsid=kaiserConfig.wi.dcsid;if(kaiserConfig.wi.isDebug){console.log("kaiser.wi.Webtrends.validate(): Configuration validation complete.");}},isEmpty:function(_16){return (_16==null||"undefined"==typeof _16||_16==""||_16=="null");},getDCSUri:function(){var uri=this.tag.DCS.dcsuri;if(typeof uri=="undefined"){if(this.dcsuri==null){var _17=document.getElementsByName("DCS.dcsuri");if(_17.length>0){this.dcsuri=_17[0].content;uri=this.dcsuri;}}else{uri=this.dcsuri;}if(kaiserConfig.wi.isDebug){console.log("kaiser.wi.Webtrends.getDCSUri(): uri from meta = ",uri.replace("^"," ")," (and if null, meta named DCS.dcsuri or its content not found or defined.)");}}else{if(kaiserConfig.wi.isDebug){console.log("kaiser.wi.Webtrends.getDCSUri(): uri from webtrends _tag object (.DCS.dcsuri = ",uri.replace("^"," "),")");}}return uri.replace("^"," ");},_trackedLinkLeveli:function(e,i){i++;var p=e.parentElement||e.parentNode;if(p==null){return 0;}else{if(p.id=="mainContent"){return 4;}else{if(p.id=="sideNav"){return 3;}else{if((p.id=="wppTopNav")&&(i>6)){return 2;}else{if(p.id=="wppTopNav"){return 1;}}}}}return this._trackedLinkLeveli(p,i);},_trackedLinkLevel:function(e){return this._trackedLinkLeveli(e,0);},_sanitize:function(str){var esc=unescape(str);return esc.replace(kaiser.wi.handler.BaseHandler.noMarkupExp," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"").replace(/\s\s*/," ");},_areaId:function(_18){switch(_18){case 1:return "PrimNav";case 2:return "SecdNav";case 3:return "LeftNav";case 4:return "PageLink";default:return "PageLink";}},getId:function(_19){tmp_domain=_tag.domain;_tag.domain=_19;_tag.dcsGetId();_tag.domain=tmp_domain;if(kaiserConfig.wi.isDebug){console.log("kaiser.wi.Webtrends.getId(wiWtIdPtr=",_19,") completed.");}}});kaiser.wi.WEBTRENDS=new kaiser.wi.Webtrends();dojo.subscribe("kaiser/wievent/multiTrack",kaiser.wi.WEBTRENDS,"_multiTrack");dojo.subscribe("kaiser/wievent/collect",kaiser.wi.WEBTRENDS,"_collect");}if(!dojo._hasResource["kaiser.wi.handler.BaseHandler"]){dojo._hasResource["kaiser.wi.handler.BaseHandler"]=true;dojo.provide("kaiser.wi.handler.BaseHandler");dojo.declare("kaiser.wi.handler.BaseHandler",null,{constructor:function(_1a){this.eventName=_1a;},multiTrack:function(_1b,_1c){dojo.publish("kaiser/wievent/multiTrack",[_1c,_1b]);},collect:function(_1d){dojo.publish("kaiser/wievent/collect",[_1d]);},_sanitize:function(str){var esc=unescape(str);return esc.replace(kaiser.wi.handler.BaseHandler.noMarkupExp," ").replace(/\s\s*/g," ");},_delay:function(ms){var _1e=new Date();while(new Date()-_1e<ms){}},fire:function(){this[this.eventName](arguments);}});kaiser.wi.handler.BaseHandler.noMarkupExp=/(<(!--|script)(.|\n[^<])*(--|script)>)|(?:<|&lt;)((?:(?:<|&lt;)[^<>]*((?:(?:<|&lt;)[^<>]*(?:>|&gt;))*[^<>]*)*(?:>|&gt;))*[^<>]*)*(?:>|&gt;)|(\&[\w]+\;)/g;}if(!dojo._hasResource["dojo.date"]){dojo._hasResource["dojo.date"]=true;dojo.provide("dojo.date");dojo.date.getDaysInMonth=function(_1f){var _20=_1f.getMonth();var _21=[31,28,31,30,31,30,31,31,30,31,30,31];if(_20==1&&dojo.date.isLeapYear(_1f)){return 29;}return _21[_20];};dojo.date.isLeapYear=function(_22){var _23=_22.getFullYear();return !(_23%400)||(!(_23%4)&&!!(_23%100));};dojo.date.getTimezoneName=function(_24){var str=_24.toString();var tz="";var _25;var pos=str.indexOf("(");if(pos>-1){tz=str.substring(++pos,str.indexOf(")"));}else{var pat=/([A-Z\/]+) \d{4}$/;if((_25=str.match(pat))){tz=_25[1];}else{str=_24.toLocaleString();pat=/ ([A-Z\/]+)$/;if((_25=str.match(pat))){tz=_25[1];}}}return (tz=="AM"||tz=="PM")?"":tz;};dojo.date.compare=function(_26,_27,_28){_26=new Date(+_26);_27=new Date(+(_27||new Date()));if(_28=="date"){_26.setHours(0,0,0,0);_27.setHours(0,0,0,0);}else{if(_28=="time"){_26.setFullYear(0,0,0);_27.setFullYear(0,0,0);}}if(_26>_27){return 1;}if(_26<_27){return -1;}return 0;};dojo.date.add=function(_29,_2a,_2b){var sum=new Date(+_29);var _2c=false;var _2d="Date";switch(_2a){case "day":break;case "weekday":var _2e,_2f;var mod=_2b%5;if(!mod){_2e=(_2b>0)?5:-5;_2f=(_2b>0)?((_2b-5)/5):((_2b+5)/5);}else{_2e=mod;_2f=parseInt(_2b/5);}var _30=_29.getDay();var adj=0;if(_30==6&&_2b>0){adj=1;}else{if(_30==0&&_2b<0){adj=-1;}}var _31=_30+_2e;if(_31==0||_31==6){adj=(_2b>0)?2:-2;}_2b=(7*_2f)+_2e+adj;break;case "year":_2d="FullYear";_2c=true;break;case "week":_2b*=7;break;case "quarter":_2b*=3;case "month":_2c=true;_2d="Month";break;default:_2d="UTC"+_2a.charAt(0).toUpperCase()+_2a.substring(1)+"s";}if(_2d){sum["set"+_2d](sum["get"+_2d]()+_2b);}if(_2c&&(sum.getDate()<_29.getDate())){sum.setDate(0);}return sum;};dojo.date.difference=function(_32,_33,_34){_33=_33||new Date();_34=_34||"day";var _35=_33.getFullYear()-_32.getFullYear();var _36=1;switch(_34){case "quarter":var m1=_32.getMonth();var m2=_33.getMonth();var q1=Math.floor(m1/3)+1;var q2=Math.floor(m2/3)+1;q2+=(_35*4);_36=q2-q1;break;case "weekday":var _37=Math.round(dojo.date.difference(_32,_33,"day"));var _38=parseInt(dojo.date.difference(_32,_33,"week"));var mod=_37%7;if(mod==0){_37=_38*5;}else{var adj=0;var _39=_32.getDay();var _3a=_33.getDay();_38=parseInt(_37/7);mod=_37%7;var _3b=new Date(_32);_3b.setDate(_3b.getDate()+(_38*7));var _3c=_3b.getDay();if(_37>0){switch(true){case _39==6:adj=-1;break;case _39==0:adj=0;break;case _3a==6:adj=-1;break;case _3a==0:adj=-2;break;case (_3c+mod)>5:adj=-2;}}else{if(_37<0){switch(true){case _39==6:adj=0;break;case _39==0:adj=1;break;case _3a==6:adj=2;break;case _3a==0:adj=1;break;case (_3c+mod)<0:adj=2;}}}_37+=adj;_37-=(_38*2);}_36=_37;break;case "year":_36=_35;break;case "month":_36=(_33.getMonth()-_32.getMonth())+(_35*12);break;case "week":_36=parseInt(dojo.date.difference(_32,_33,"day")/7);break;case "day":_36/=24;case "hour":_36/=60;case "minute":_36/=60;case "second":_36/=1000;case "millisecond":_36*=_33.getTime()-_32.getTime();}return Math.round(_36);};}if(!dojo._hasResource["kaiser.wi.handler.ActionHandler"]){dojo._hasResource["kaiser.wi.handler.ActionHandler"]=true;dojo.provide("kaiser.wi.handler.ActionHandler");dojo.declare("kaiser.wi.handler.ActionHandler",kaiser.wi.handler.BaseHandler,{clickSearch:function(_3d){var _3e=[];var _3f=this._sanitize(_3d[0]);if(dojo.cookie.isSupported()){var _40;if(_40=dojo.cookie("kpWIsupport")){var _41=_40.split(";");if(_41[_41.length-1]!=_3f){_40+=_3f+";";}}else{_40=_3f+";";}dojo.cookie("kpWIsupport",_40,{path:"/",expires:dojo.date.add(new Date(),"minute",3)});}var _42="";if(_3d.length>1){_42=this._sanitize(_3d[1]);for(var i=2;i<_3d.length;i++){_42=_42.concat(";",this._sanitize(_3d[i]));}}_3e.push("WT.oss",_3f);_3e.push("DCSext.kp_searchFacets",_42);_3e.push("DCSext.kp_searchTerms",_40);_3e.push("WT.dl","65");this.multiTrack(_3e,"search_action");this._delay(500);},clickSearchResult:function(_43){var _44=[];_44.push("WT.oss",this._sanitize(_43[0]));_44.push("WT.dl","60");if(_43.length>1){var _45=_43[1];_44.push("DCSext.kp_searchRank","Ranking "+_45);}this.multiTrack(_44,"search_result_selected");this._delay(500);},clickPrinterFriendly:function(_46){var _47=[];_47.push("DCSext.kp_userAction","PrinterFriendly");_47.push("WT.dl","62");this.multiTrack(_47,"printer_friendly");},uiWidgetAction:function(_48){var _49=[];_49.push("DCSext.kp_uiWidgetAction",this._sanitize(_48[0]));_49.push("DCSext.kp_uiWidgetTitle",this._sanitize(_48[1]));_49.push("WT.dl","70");this.multiTrack(_49,"ui_widget_action");},clickCMDownload:function(_4a){var _4b=[];_4b.push("DCSext.kp_userAction","CMDownload");var _4c=_4a.split("|");for(var i=0;i<_4c.length;i++){var _4d=_4c[i].split("=");_4b.push("DCSext.kp_"+_4d[0],_4d[1]);}_4b.push("WT.dl","80");this.multiTrack(_4b,"cm_download_link");}});}if(!dojo._hasResource["kaiser.wi.handler.ArticleHandler"]){dojo._hasResource["kaiser.wi.handler.ArticleHandler"]=true;dojo.provide("kaiser.wi.handler.ArticleHandler");dojo.declare("kaiser.wi.handler.ArticleHandler",kaiser.wi.handler.BaseHandler,{viewArticle:function(_4e){local=[];local.push("DCSext.kp_article_name",_4e[0]);local.push("DCSext.kp_article_region",_4e[1]);local.push("DCSext.region_of_membership",_4e[2]);tokens=kaiser.wi.BROKER.viewContent.parseUri();answer=local.concat(tokens);this.multiTrack(answer,"view_article");},viewCCArticle:function(_4f){local=[];local.push("DCSext.kp_content_center",_4f[0]);local.push("DCSext.kp_article_name",_4f[1]);local.push("DCSext.region_of_membership",_4f[2]);tokens=kaiser.wi.BROKER.viewContent.parseUri();answer=local.concat(tokens);this.multiTrack(answer,"view_cc_article");}});}if(!dojo._hasResource["kaiser.wi.handler.ScenarioHandler"]){dojo._hasResource["kaiser.wi.handler.ScenarioHandler"]=true;dojo.provide("kaiser.wi.handler.ScenarioHandler");dojo.declare("kaiser.wi.handler.ScenarioHandler",kaiser.wi.handler.BaseHandler,{scenario:function(_50){local=[];local.push("WT.si_n",_50[0]);local.push("WT.si_x",_50[1]);local.push("DCSext.region_of_membership",_50[2]);this.multiTrack(local,"kp_scenario_analysis");},scenarioFinished:function(_51){local=[];local.push("WT.si_n",_51[0]);local.push("WT.si_x",_51[1]);local.push("WT.si_cs","1");local.push("DCSext.region_of_membership",_51[2]);this.multiTrack(local,"kp_scenario_analysis");},proxyReporting:function(_52){local=[];local.push("WT.dl","67");local.push("DCSext.rel_Type",_52[0]);local.push("DCSext.proxy_switcher",_52[1]);local.push("DCSext.delPrefLang",_52[2]);local.push("DCSext.subPrefLang",_52[3]);this.multiTrack(local,"kp_proxy_reporting");}});}if(!dojo._hasResource["kaiser.wi.handler.ViewItemHandler"]){dojo._hasResource["kaiser.wi.handler.ViewItemHandler"]=true;dojo.provide("kaiser.wi.handler.ViewItemHandler");dojo.declare("kaiser.wi.handler.ViewItemHandler",kaiser.wi.handler.BaseHandler,{viewItem:function(_53){local=[];local.push("DCSext.kp_vi_type",_53[0]);local.push("DCSext.kp_vi_id",_53[1]);local.push("DCSext.kp_vi_name",_53[2]);local.push("DCSext.kp_vi_reg",_53[3]);local.push("DCSext.kp_vi_sub_pages",_53[4]);local.push("DCSext.kp_vi_p1",_53[5]);local.push("DCSext.kp_vi_p2",_53[6]);local.push("DCSext.kp_vi_p3",_53[7]);local.push("DCSext.kp_vi_p4",_53[8]);local.push("DCSext.kp_vi_p5",_53[9]);local.push("DCSext.kp_vi_p6",_53[10]);local.push("DCSext.kp_vi_p7",_53[11]);local.push("DCSext.region_of_membership",_53[12]);this.multiTrack(local,"kp_view_item");}});}if(!dojo._hasResource["kaiser.wi.handler.PortletHandler"]){dojo._hasResource["kaiser.wi.handler.PortletHandler"]=true;dojo.provide("kaiser.wi.handler.PortletHandler");dojo.declare("kaiser.wi.handler.PortletHandler",kaiser.wi.handler.BaseHandler,{findPortlets:function(){if(kaiserConfig.wi.isDebug){console.log("kaiser.wi.handler.PortletHandler.findPortlets(): Searching for portlet titles.");}dojo.query("span[id^='title.']").forEach(function(_54){this.viewPortlet(_54.innerHTML);});},viewPortlet:function(_55){local=[];local.push("DCSext.portlet_title",_55[0]);this.multiTrack(local,"view_portlet");}});}if(!dojo._hasResource["kaiser.wi.handler.PageHandler"]){dojo._hasResource["kaiser.wi.handler.PageHandler"]=true;dojo.provide("kaiser.wi.handler.PageHandler");dojo.declare("kaiser.wi.handler.PageHandler",kaiser.wi.handler.BaseHandler,{viewPage:function(_56){if(!this._isInit){this.collect("kp_page_view");this._isInit=!kaiserConfig.wi.isSSA;}else{this.multiTrack(_56,"kp_page_view");}}});}if(!dojo._hasResource["kaiser.wi.handler.ContentHandler"]){dojo._hasResource["kaiser.wi.handler.ContentHandler"]=true;dojo.provide("kaiser.wi.handler.ContentHandler");dojo.declare("kaiser.wi.handler.ContentHandler",kaiser.wi.handler.BaseHandler,{viewContent:function(_57){local=this.parseUri();this.multiTrack(local,"view_content");},parseUri:function(){var uri=kaiser.wi.WEBTRENDS.getDCSUri();filter=kaiserConfig.wi.hccFilter;result=[];if(filter.test(uri)){tokens=filter.exec(uri).pop().split("/");switch(tokens.length){case 1:result.push("DCSext.kp_topic_center",tokens.shift());result.push("DCSext.kp_topic_overview",this.DEFAULT_TOKEN);result.push("DCSext.kp_topic",this.DEFAULT_TOKEN);break;case 2:result.push("DCSext.kp_topic_center",tokens.shift());result.push("DCSext.kp_topic_overview",tokens.shift());result.push("DCSext.kp_topic",this.DEFAULT_TOKEN);break;case 3:result.push("DCSext.kp_topic_center",tokens.shift());result.push("DCSext.kp_topic_overview",tokens.shift());result.push("DCSext.kp_topic",tokens.shift());break;default:console.error("kaiser.wi.handler.ContentHandler.parseUri(): Invalid token length: ",tokens.length);}}else{console.warn("kaiser.wi.handler.ContentHandler.parseUri(): hccfilter (",filter,") does not match. Probably a viewArticle fired outside the HCC or environment setting incorrect.");}return result;},DEFAULT_TOKEN:"-"});}if(!dojo._hasResource["kaiser.wi.handler.ConditionHandler"]){dojo._hasResource["kaiser.wi.handler.ConditionHandler"]=true;dojo.provide("kaiser.wi.handler.ConditionHandler");dojo.declare("kaiser.wi.handler.ConditionHandler",kaiser.wi.handler.BaseHandler,{condition:function(_58){if(_58.length>0){var _59=[];_59.push("WT.dl","61");_59.push("DCSext.kp_condition_description",_58[0]);this.multiTrack(_59,"condition");}else{if(kaiserConfig.wi.isDebug){console.log("condition handler fired but not passed parameter");}}}});}if(!dojo._hasResource["kaiser.wi.handler.RegistrationHandler"]){dojo._hasResource["kaiser.wi.handler.RegistrationHandler"]=true;dojo.provide("kaiser.wi.handler.RegistrationHandler");dojo.declare("kaiser.wi.handler.RegistrationHandler",kaiser.wi.handler.BaseHandler,{regUser:function(_5a){var _5b=[];var _5c=_5a[0];var n=10;var _5d=Math.floor(_5a[1]/n)*n;var _5e=_5d+"-"+(_5d+(n-1));var _5f=_5a[2];_5b.push("DCSext.kp_user_rom",_5c);_5b.push("DCSext.kp_user_age_range",_5e);_5b.push("DCSext.kp_user_guid",_5f);_5b.push("WT.dl","71");this.multiTrack(_5b,"user_registration");}});}if(!dojo._hasResource["kaiser.wi.handler.MappedHandler"]){dojo._hasResource["kaiser.wi.handler.MappedHandler"]=true;dojo.provide("kaiser.wi.handler.MappedHandler");dojo.declare("kaiser.wi.handler.MappedHandler",kaiser.wi.handler.BaseHandler,{mapped:function(_60){var _61=_60[0];var _62=[];if(_61.WT){for(var _63 in _61.WT){_62.push("WT."+_63,_61.WT[_63]);}}if(_61.DCS){for(var _64 in _61.DCSext){_62.push("DCSext."+_64,_61.DCS[_64]);}}if(_61.DCSext){for(var _65 in _61.DCSext){_62.push("DCSext."+_65,_61.DCSext[_65]);}}this.multiTrack(_62,_61.wiEventName);}});}if(!dojo._hasResource["kaiser.wi.Broker"]){dojo._hasResource["kaiser.wi.Broker"]=true;dojo.provide("kaiser.wi.Broker");dojo.declare("kaiser.wi.Broker",null,{performCollect:true,constructor:function(){if(kaiserConfig.wi.isDebug){console.log("kaiser.wi.Broker.constructor(): Instantiating.");}this.held=[];this.isHolding=true;this.wiEventHandle=dojo.subscribe("kaiser/wiEvent",function(_66,_67){if("true"==kaiserConfig.wi.isActive){if(kaiser.wi.BROKER.isHolding){if(kaiserConfig.wi.isDebug){console.log("kaiser.wi.Event/Broker.fire(): holding ",_66);}kaiser.wi.BROKER.held.push({name:_66,args:_67});}else{if((typeof _66=="undefined")||(_66.length<1)){console.error("\"kaiser/wiEvent\" subscriber (in kaiser.wi.Broker.js) received no or empty eventName.");return;}if(kaiserConfig.wi.isDebug){console.log("\"kaiser/wiEvent\" subscriber (in kaiser.wi.Broker.js) firing: ",_66);}kaiser.wi.BROKER._fire(_66,_67);}}else{if(kaiserConfig.wi.isDebug){console.log("\"kaiser/wiEvent\" subscriber (in kaiser.wi.Broker.js) NOT handling event: ",_66," because isActive: false.");}}});this.wiUserRegHandle=dojo.subscribe("kaiser/wiUserReg",function(_68){if(kaiserConfig.wi.isDebug){console.log("\"kaiser/wiUserReg\" subscriber (in kaiser.wi.Broker.js) invoked");}dojo["require"]("kaiser.wi.PageMetaAmend");kaiser.wi.METAMEND.amendPageMeta(_68);_tag.dcsMeta();if(kaiserConfig.wi.isDebug){console.log("\"kaiser/wiUserReg\" event processed");}});this.wiMetaParamHandle=dojo.subscribe("kaiser/wiMetaParam",function(_69,_6a){if(kaiserConfig.wi.isDebug){console.log("\"kaiser/wiMetaParam\" subscriber (in kaiser.wi.Broker.js) invoked");}dojo["require"]("kaiser.wi.PageMetaAmend");if(kaiserConfig.wi.isDebug){console.log("\"kaiser/wiMetaParam\" args length = "+_6a.length);}kaiser.wi.METAMEND.updatePageMeta(_6a);_tag.dcsMeta();if(kaiserConfig.wi.isDebug){console.log("\"kaiser/wiMetaParam\" event processed");}});},fire:function(){if("true"==kaiserConfig.wi.isActive){var _6b=[];for(var i=0;i<arguments.length;i++){_6b.push(arguments[i]);}var _6c=_6b.shift();if(typeof (_6b[0])!="string"){_6b=_6b[0];}if(this.isHolding){if(kaiserConfig.wi.isDebug){console.log("kaiser.wi.Event/Broker.fire(): holding ",_6c);}this.held.push({name:_6c,args:_6b});}else{this._fire(_6c,_6b);}}else{if(kaiserConfig.wi.isDebug){console.log("kaiser.wi.Broker) NOT firing event: ",_6c," because isActive: false.");}}},_fire:function(_6d,_6e){if(kaiserConfig.wi.isDebug){console.log("kaiser.wi.Event/Broker.fire(): firing ",_6d);}if(_handler=kaiser.wi.BROKER[_6d]){if(dojo.isFunction(_handler[_6d])){_handler[_6d](_6e);}}else{if(kaiserConfig.wi.isDebug){console.log("\"kaiser/wiEvent\" subscriber (in kaiser.wi.Broker.js) NOT firing: ",_6d," because it's function is not initialized.");}}},release:function(){if(kaiserConfig.wi.isDebug){console.log("kaiser.wi.Broker.release()");}this.isHolding=false;var _6f=null;var _70=[];for(var idx=0;idx<this.held.length;idx++){_6f=this.held[idx];if(_6f.name=="viewPage"&&this.performCollect){if(kaiserConfig.wi.isDebug){console.log("kaiser.wi.Broker.release(): Part 1 - firing ",_6f.name);}this._fire(_6f.name,_6f.args);}}for(var idx=0;idx<this.held.length;idx++){_6f=this.held[idx];if(_6f.name=="kaiser/wievent/condition"){_70.push(_6f);}else{if(_6f.name!="viewPage"){if(kaiserConfig.wi.isDebug){console.log("kaiser.wi.Broker.release(): Part 2 - firing ",_6f.name);}this._fire(_6f.name,_6f.args);}}}for(var idx=0;idx<_70.length;idx++){_6f=_70[idx];if(kaiserConfig.wi.isDebug){console.log("kaiser.wi.Broker.release(): Part 3 - firing ",_6f.name);}this._fire(_6f.name,_6f.args);}},scenario:new kaiser.wi.handler.ScenarioHandler("scenario"),scenarioFinished:new kaiser.wi.handler.ScenarioHandler("scenarioFinished"),proxyReporting:new kaiser.wi.handler.ScenarioHandler("proxyReporting"),viewItem:new kaiser.wi.handler.ViewItemHandler("viewItem"),viewPortlet:new kaiser.wi.handler.PortletHandler("viewPortlet"),viewPage:new kaiser.wi.handler.PageHandler("viewPage"),viewContent:new kaiser.wi.handler.ContentHandler("viewContent"),viewArticle:new kaiser.wi.handler.ArticleHandler("viewArticle"),viewCCArticle:new kaiser.wi.handler.ArticleHandler("viewCCArticle"),clickSearch:new kaiser.wi.handler.ActionHandler("clickSearch"),clickSearchResult:new kaiser.wi.handler.ActionHandler("clickSearchResult"),clickPrinterFriendly:new kaiser.wi.handler.ActionHandler("clickPrinterFriendly"),condition:new kaiser.wi.handler.ConditionHandler("condition"),uiWidgetAction:new kaiser.wi.handler.ActionHandler("uiWidgetAction"),regUser:new kaiser.wi.handler.RegistrationHandler("regUser"),mapped:new kaiser.wi.handler.MappedHandler("mapped"),clickCMDownload:new kaiser.wi.handler.ActionHandler("clickCMDownload"),searchAction:new kaiser.wi.handler.ActionHandler("searchAction")});kaiser.wi.BROKER=new kaiser.wi.Broker();}if(!dojo._hasResource["kaiser.wi.PageAdapter"]){dojo._hasResource["kaiser.wi.PageAdapter"]=true;dojo.provide("kaiser.wi.PageAdapter");dojo.requireIf(!("true"==kaiserConfig.wi.isSSA),"com.ibm.portal.EventBroker");dojo.requireIf(!("true"==kaiserConfig.wi.isSSA),"kaiser.wi.AnchorFilter");dojo.requireIf(!("true"==kaiserConfig.wi.isSSA),"kaiser.wi.handler.CSAListener");dojo.declare("kaiser.wi.PageAdapter",null,{constructor:function(){if(kaiserConfig.wi.isDebug){console.log("kaiser.wi.PageAdapter.constructor(): Instantiating.");}},register:function(){if(kaiserConfig.wi.isDebug){console.log("kaiser.wi.PageAdapter.register().");}if("true"===kaiserConfig.wi.isSSA){dojo.addOnLoad(dojo.hitch(this,"notify"));}else{com.ibm.portal.EVENT_BROKER.stateChanged.register(this,this.stateChanged);if(kaiserConfig.wi.isDebug){console.log("kaiser.wi.PageAdapter.constructor(): PageAdapter registered with IBM EVENT_BROKER.");}}},notify:function(){if(kaiserConfig.wi.isDebug){console.log("kaiser.wi.PageAdapter.notify(): viewPage processing.");}if(kaiser.wi.BROKER.isHolding){kaiser.wi.BROKER.held.push({name:"viewPage",args:[]});if(kaiserConfig.wi.isDebug){console.log("kaiser.wi.PageAdapter.notify(): viewPage held.");}}else{kaiser.wi.BROKER["viewPage"].viewPage();kaiser.wi.BROKER.performCollect=false;if(kaiserConfig.wi.isDebug){console.log("kaiser.wi.PageAdapter.notify(): viewPage immediately sent.");}}this._notifyPortlets();this._notifyContent();},stateChanged:function(){this.changeMeta("DCS.dcsuri",this.makeUri());this.notify();},makeUri:function(){var _71=com.ibm.portal.navigation.controller.NAVIGATION_CONTROLLER.getState();var _72=_71.selectionModel.selectionPath;var max=_72.length;if(kaiser.wi.WEBTRENDS.isEmpty(kaiserConfig.wi.navStartLevel)){console.warn("kaiser.wi.PageAdapter.makeUri(): Set default value: kaiserConfig.wi.navStartLevel=1");kaiserConfig.wi.navStartLevel=1;}var uri="";for(var idx=kaiserConfig.wi.navStartLevel;idx<max;idx++){uri+="/"+_72[idx].title;}return uri;},changeMeta:function(_73,_74){dojo.query("meta").forEach(function(_75){if(_73===_75.name){_75.content=_74;}});},_notifyPortlets:function(){kaiser.wi.BROKER["viewPortlet"].findPortlets();dojo.query("span[id^='title.']").forEach(function(_76){if(kaiser.wi.BROKER.isHolding){local=[];local.push("DCSext.portlet_title",_76.innerHTML);kaiser.wi.BROKER.held.push({name:"viewPortlet",args:local});if(kaiserConfig.wi.isDebug){console.log("kaiser.wi.PageAdapter.notify(): viewPortlet held.");}}else{if(kaiser.wi.BROKER.performCollect){kaiser.wi.BROKER["viewPage"].collect("kp_page_view");kaiser.wi.BROKER.performCollect=false;}kaiser.wi.BROKER["viewPortlet"].viewPortlet(_76.innerHTML);if(kaiserConfig.wi.isDebug){console.log("kaiser.wi.PageAdapter.notify(): viewPortlet immediately sent.");}}});},_notifyContent:function(){if(""!==kaiserConfig.wi.hccFilter){if(kaiser.wi.BROKER.performCollect){kaiser.wi.BROKER["viewPage"].collect("kp_page_view");kaiser.wi.BROKER.performCollect=false;}var uri=kaiser.wi.WEBTRENDS.getDCSUri();if(kaiserConfig.wi.isDebug){console.log("kaiser.wi.PageAdapter._notifyContent(): dcsuri: ",uri);}if(kaiserConfig.wi.hccFilter.test(uri)){kaiser.wi.BROKER["viewContent"].viewContent();}}else{console.warn("kaiser.wi.PageAdapter._notifyContent(): Missing value for kaiserConfig.wi.hccFilter.");}}});kaiser.wi.PAGEADAPTER=new kaiser.wi.PageAdapter();}if(!dojo._hasResource["kaiser.wi.PageMetaAmend"]){dojo._hasResource["kaiser.wi.PageMetaAmend"]=true;dojo.provide("kaiser.wi.PageMetaAmend");dojo.declare("kaiser.wi.PageMetaAmend",null,{updatePageMeta:function(_77){if(kaiserConfig.wi.isDebug){console.log("\"kaiser/wiMetaParam:updatePageMeta\" params length ="+_77.length);}if(kaiserConfig.wi.isDebug){console.log("\"kaiser/wiMetaParam:updatePageMeta\" params ="+_77);}if(_77.length%2==0){var cur=0;while(cur<_77.length){var nm=_77[cur];var vl=_77[cur+1];if(kaiserConfig.wi.isDebug){console.log("\"kaiser/wiMetaParam:updatePageMeta\" nm:vl == "+_77[cur]+" : "+_77[cur+1]);}if(metaNode=dojo.query("meta[name='DCSExt."+nm+"']")[0]){metaNode.content=vl;if(kaiserConfig.wi.isDebug){console.log("\"kaiser/wiMetaParam:updatePageMeta\" "+nm);}}cur=cur+2;}}},amendPageMeta:function(_78){if(_78.rom){if(metaNode=dojo.query("meta[name='DCSExt.region_of_membership']")[0]){metaNode.content=_78.rom;}}var _79=null;if(!_78.age&&_78.birthdate){var _7a=new Date();var _7b=_7a.getFullYear();var age=_7b-_78.birthdate.yr;var _7c=_7a.getMonth();var _7d=_7a.getDate();if(_78.birthdate.yr&&_78.birthdate.month&&_78.birthdate.day){if(_78.birthdate.month>_7c){age=age-1;}else{if(_78.birthdate.month==_7c&&_7d<_78.birthdate.day){age=age-1;}}_78.age=age;}}if(_78.age){if(metaNode=dojo.query("meta[name='DCSExt.age']")[0]){metaNode.content=_78.age;}}if(_78.guid){if(metaNode=dojo.query("meta[name='DCSExt.guid']")[0]){metaNode.content=_78.guid;}}}});kaiser.wi.METAMEND=new kaiser.wi.PageMetaAmend();}
