/* Copyright Â© 2016 Epic Systems Corporation. */

/*! Copyright (c) Epic Systems Corporation 2014-2015 */
$$WP.Utilities.declareComponent("Containers.Popup");$$WP.Containers.Popup.prototype={HasOverlay:true,IsClosable:true,Class:"Popup",PositioningFunction:$$WP.Containers.Positions.InsideCentered,Buttons:null,_Init:function $$WP$Containers$Popup$_Init(b){var a=this;b.Class+=" Popup "+(b.Class||(a.Class&&a.Class!=="Popup"?a.Class:""));b.Events.push("click");b.Events.push("keydown");a.Containers$Container(b);a.PositioningFunction=b.PositioningFunction||a.PositioningFunction;delete b.PositioningFunction;a.Buttons=$$WP.Utilities.mergeObjects(a.Buttons||[],b.Buttons,true);if(a.Buttons===null||a.Buttons.length===0)a.$container.addClass("nobuttons");else{a.buttonComponent=new $$WP.Components.ButtonBar({Data:{Class:"buttoncontainer ",Buttons:a.Buttons},_clickContext:b._clickContext||a,_click:b._click||a._click});a.$container.append(a.buttonComponent.$container);a.buttonComponent.show();a.buttonComponent.Container=a}a.HasOverlay=b.HasOverlay||a.HasOverlay},show:function Containers$Popup$show(b){var a=this;if(a._visible===true)return;a.Containers$Container$show(b);a.focus();$$WP.Containers.Popup.scrollPreventer.on();if(a.HasOverlay)$$WP.Containers.Popup.overlay.on(!a.IsClosable,a);a.reposition(true);try{a.firstFocus=WP.DOM.Search.getNextFocusable(a.$content.get(0))}catch(c){}try{a.lastFocus=WP.DOM.Search.getLastFocusable(a.$container.get(0))}catch(d){}a.isFirstFocus=true},hide:function Containers$Popup$hide(b){var a=this;if(a._visible===false)return;a.Containers$Container$hide(b);a._visible=false;$$WP.Containers.Popup.scrollPreventer.off();a.HasOverlay&&$$WP.Containers.Popup.overlay.off(!a.IsClosable,a);try{a._previousFocus.focus()}catch(c){}},refresh:function Containers$Popup$refresh(a){this.Containers$Container$refresh();this.reposition(a)},dispose:function $$WP$Containers$Popup$dispose(){this.hide();this.Containers$Container$dispose()},reposition:function Containers$Popup$reposition(b){var a=this;if(a.$container.parent().length===0)return;a.$container.css("opacity",0);try{a.PositioningFunction({data:a},b)}catch(c){throw"repositioning error";}a.$container.css("opacity",1)},_keydown:function $$WP$Containers$Popup$trapUserInBox(b){var c=false,a=this;b.keyCode===27&&a.dispose(c);if(b.keyCode!==9)return true;if(b.target!==a.firstFocus&&b.target!==a.lastFocus){if(a.isFirstFocus){var d=b.shiftKey?a.lastFocus:a.firstFocus;d&&d.focus();delete a.isFirstFocus;return c}return true}if(b.shiftKey&&b.target===a.firstFocus){a.lastFocus&&a.lastFocus.focus();if(a.isFirstFocus)delete a.isFirstFocus;return c}else if(!b.shiftKey&&b.target===a.lastFocus){a.firstFocus&&a.firstFocus.focus();if(a.isFirstFocus)delete a.isFirstFocus;return c}return true}};$$WP.Containers.Popup.overlay={zIndex:0,on:function Containers$Popup$Overlay$on(c,a,b){b=b||$("#main");$$WP.Utilities.runOne.on("$$WP.Containers.Popup.overlay"+a._componentNumber,function(){$$WP.Containers.Popup.overlay.zIndex+=3;var c=document.createElement("div"),d=3e3+$$WP.Containers.Popup.overlay.zIndex;c=$$WP.Templates.overlay({});this.$overlay=$(c);b.append(a.$overlay);this.$overlay.show();a.$overlay.css("z-index",d);a.$container.css("z-index",d+1)},a);if(!c)a.$overlay.on("click","",a._componentNumber,this.overlayClick)},off:function Containers$Popup$overlay$off(b,a){!b&&a.$overlay.off("click","",this.overlayClick);$$WP.Utilities.runOne.off("$$WP.Containers.Popup.overlay"+a._componentNumber,function(){this.$overlay.remove()},a)},overlayClick:function $$WP$Containers$Popup$overlay$overlayClick(a){var b=$$WP.Components.getInstance(a.data);if(b)b.dispose();else this.off(false,{_componentNumber:a.data,$overlay:$(a.target)});return $$WP.Utilities.preventEvent(a)}};$$WP.Containers.Popup.scrollPreventer={on:function Containers$Popup$scrollPreventer$on(){$$WP.Utilities.runOne.on("$$WP.Containers.Popup.scrollPreventer",function Containers$Popup$scrollPrevent$innerOn(){$(window).scroll(null,$$WP.Utilities.preventEvent)})},off:function Containers$Popup$scrollPrevent$off(){$$WP.Utilities.runOne.off("$$WP.Containers.Popup.scrollPreventer",function Containers$Popup$scrollPreventer$innerOff(){$(window).off("scroll","",$$WP.Utilities.preventEvent)})}};$$WP.Containers.Popup.extend("Containers.Container")