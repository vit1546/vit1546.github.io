/* Copyright Â© 2016 Epic Systems Corporation. */

/*! Copyright (c) Epic Systems Corporation 2014-2015
*mborofsk 7/13 266376 - fix for loading component with no override text
*kagr    11/15 I8134027 - change popup behaviour to stop events only if explicitly returned false
*/
$$WP.Utilities.guaranteeExistence($$WP,"Behaviors");$$WP.Behaviors.DynamicScroller={maxOpacity:.8,maxAtDistance:100,add:function Behaviors$DynamicScroller$add(a,m){var l="noScrollbar",k="hasScrollbar",e="div",j="overflow-x",g="scroll",i="overflow-y",d,b,h,f,c=false;$$WP.Behaviors.DynamicScroller.remove(a,false);a.css(i,g);a.css(j,g);if(a.get(0).scrollHeight>a.innerHeight()){d=document.createElement(e);d.className="scrollshadow top";a.append(d);b=document.createElement(e);b.className="scrollshadow bottom";a.append(b);c=true}else a.css(i,"");if(a.get(0).scrollWidth>a.innerWidth()){d=document.createElement(e);a.append(d);d.className="scrollshadow left";b=document.createElement(e);b.className="scrollshadow right";a.append(b);c=true}else a.css(j,"");if(c){a.on(g,"",null,$$WP.Behaviors.DynamicScroller.onScroll);$$WP.Behaviors.DynamicScroller.onScroll({target:a.get(0)});a.addClass(k);a.removeClass(l)}else{a.removeClass(k);a.addClass(l)}if(m){h=a.children();for(f=h.length-1;f>-1;f--)c=c||$$WP.Behaviors.DynamicScroller.add($(h[f]),true)}return c},remove:function Behaviors$DynamicScroller$remove(b,d){b.off("scroll","",$$WP.Behaviors.DynamicScroller.onScroll);if(d)for(var c=b.children(),a=c.length;a>-1;a--)$$WP.Behaviors.DynamicScroller.remove($(c[a]),true)},onScroll:function Behaviors$DynamicScroller$onScroll(f){var c=f.target,b=$(c),g,a,e,d;a={top:c.scrollTop,left:c.scrollLeft};a.bottom=c.scrollHeight-a.top-b.height();a.right=c.scrollWidth-a.left-b.width();g=b.children(".scrollshadow");g.each(function(b,c){var d=this.className.substr(13),e=Math.round(100*b*a[d]/c,2)/100;$(this).css("opacity",Math.min(e,b))},[$$WP.Behaviors.DynamicScroller.maxOpacity,$$WP.Behaviors.DynamicScroller.maxAtDistance]);d=b.data("scroll");if(d&&f.type==="scroll"){e=$$WP.Components.findComponent(b.get(0));typeof e[d]==="function"&&e[d](f)}}};$$WP.Behaviors.FillContainer=function Behaviors$FillContainer(e){for(var a,b,c,g=function(b,c){var a=$(this);a.css("height",a.height()+b/c)},f=function(){b-=$(this).height()},d=0;d<e.length;d++){a=$(e.get(d).parentNode);while(a.length>0&&!a.hasClass("filledContainer"))a=a.parent();b=a.height()||window.innerHeight;a.children().each(f);if(b===0)break;c=a.find(".fillContainer");c.each(g,[b,c.length])}};$$WP.Behaviors.EventHandlers={on:function Behaviors$EventHandlers$on(b,a){$$WP.Utilities.runOne.on("$$WP.Behaviors.EventsHandlers."+b+a._componentNumber,function(a){var c=$(a&&a.$container?a.$container:document.body);c.on(b,"",a._componentNumber,$$WP.Behaviors.EventHandlers._eventProcessor)},this,[a])},off:function Behaviors$EventHandlers$off(b,a){$$WP.Utilities.runOne.off("$$WP.Behaviors.EventsHandlers."+b+a._componentNumber,function(a){var c=$(a&&a.$container?a.$container:document.body);c.off(b,"",$$WP.Behaviors.EventHandlers._eventProcessor)},this,[a])},_eventProcessor:function Behaviors$EventHandlers$_eventProcessor(d){var i="function",f=d.target,c=$(f),b,e=$$WP.Components.getInstance(d.data),j=document.body,a,g,h;if(!e)throw"Unable to associate event with component";a=c.attr("data-id");while(f!==j&&!a&&a!=="0"&&isNaN(c.attr("data-component"))){f=f.parentNode;c=$(f);a=c.attr("data-id")}if(c.hasClass("disabled")||!a&&a!=="0")return;b="_"+d.type;if(typeof e[b]!==i)throw"Must create function called '"+b+"' in the object prototype that descends from Component.  It will accept (data-id, $a tag that was clicked, $evt)";g=e[b+"Context"]||e;if(typeof g[b]===i)h=g[b](d,a,c);else h=e[b].apply(g,[d,a,c]);if(h===false){$$WP.Utilities.preventEvent(d);return false}}};$$WP.Behaviors.Server={addRequest:function Behaviors$Server$addRequest(d,e,g,c,b){d.Server=d.Server||{};d.Server[e]=d.Server[e]||{action:e};var a=d.Server[e],f;d[e]=$.proxy($$WP.Behaviors.Server.makeRequest,a);d[e+"Cancel"]=$.proxy($$WP.Behaviors.Server.cancelRequest,a);a.Url=g;a.successCallback=c.success;a.failCallback=c.failure;a.action=e;f=c.context;delete c.context;a.$ajaxSettings=$$WP.Utilities.mergeObjects({type:"POST",data:c.data||{},dataType:c.dataType||"html",cache:c.cache===true,context:c.context,failure:function $$WP$Utilities$Server(){throw"call to server failed";}},$$WP.Utilities.copyObject(c));a.$ajaxSettings.context=f||d._componentNumber;a.$ajaxSettings.success=$$WP.Behaviors.Server.serverCallback;a.componentNumber=d._componentNumber;if(b&&b.show&&b.hide)a.defaultLoadingComponent=b;else if(b!==false){b=typeof b==="string"?b:"";a.defaultLoadingComponent=new $$WP.Popups.Loading({Content:{Data:{ExtraMessage:b}}})}},removeRequest:function Behaviors$Server$removeRequest(a,b){delete a[b];delete a[b+"Cancel"];delete a.Server[b]},cancelRequest:function Behaviors$Server$cancelRequest(){var a=this;a.cancelRequest=true;a.loadingIndicatorComponent&&a.loadingIndicatorComponent.hide();delete a.loadingIndicatorComponent;delete a.waitingForResponse},makeRequest:function Behaviors$Server$makeRequest(d,c,i,j){var g="Parameterizer",a=this,h=$$WP.Components.getInstance(a.componentNumber),b,f=$$WP.Utilities.copyObject(c),e,l=$(document.body),k=a.Url+"?componentNumber="+a.componentNumber+"&";delete a.cancelRequest;if(typeof d==="string")b=d;else if(typeof h[a.action+g]==="function"){b=h[a.action+g](d);if(typeof b!=="string")return}else if(typeof d==="undefined")b="";else throw"your component must implement "+a.action+"Parameters to load off of partial objects (accepts a partial object)";e={parameters:b,ajaxObjectOverrides:c||{},action:a.action};if(a.lastRequest&&a.lastRequest.parameters===e.parameters)return;if(a.waitingForResponse){a.nextRequest=e;return false}c=c||{};f.url=c.url||k+b;f.context=a;f.success=$$WP.Behaviors.Server.serverCallback;$.ajax($$WP.Utilities.mergeObjects(a.$ajaxSettings,f));a.currentRequest=e;a.waitingForResponse=true;a.loadingIndicatorComponent=i||a.defaultLoadingComponent;if(a.loadingIndicatorComponent!==false)try{a.loadingIndicatorComponent.show()}catch(m){}a.showComponentAfterLoad=j===true;a.lastRequest=a.currentRequest},serverCallback:function Behaviors$Server$serverCallback(e){var a=this,b=!isNaN(a.componentNumber)?$$WP.Components.Instances[a.componentNumber]:a,c,d;if(a.cancelRequest===true)return;delete a.waitingForResponse;if(a.nextRequest){c=a.nextRequest;delete a.nextRequest;b[c.action](c.parameters,c.callback);return}if(a.loadingIndicatorComponent)try{a.loadingIndicatorComponent.hide()}catch(g){}d=a.currentRequest.ajaxObjectOverrides.success||a.successCallback;d.apply(b,[e]);if(a.showComponentAfterLoad&&b.show)try{b.show()}catch(f){}}}